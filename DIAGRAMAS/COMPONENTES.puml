@startuml

skinparam backgroundColor #FFFFFF
skinparam shadowing false
skinparam roundcorner 12
skinparam linetype ortho

skinparam componentStyle rectangle
skinparam ArrowColor #4B5563
skinparam ArrowThickness 1.2

skinparam package {
  BackgroundColor #FFFFFF
  BorderColor #CBD5E1
}

skinparam component {
  BackgroundColor #F8FAFC
  BorderColor #1E293B
  FontColor #111827
  FontSize 12
}

skinparam nodesep 120
skinparam ranksep 155

' ====================================
' FRONTEND
' ====================================
package "Frontend (Next.js + React)" as FE {

  component "Web UI" as WebUI
  component "Gestor de Sesión\n(NextAuth)" as SessionUI
  component "Gestor de Archivos\n(Cliente Blob)" as UploadUI
}

' ====================================
' SERVICIOS EXTERNOS
' ====================================
package "Servicios Externos" as Ext {

  component "Vercel Blob Storage\n(Archivos)" as VercelBlob
  component "Microsoft Entra ID\n(SSO / OIDC)" as Entra
}

' ====================================
' BACKEND
' ====================================
package "Backend (Node.js / Express / API REST)" as BE {

  component "API Gateway" as APIGW
  component "Servicio de Contenido" as SContenido
  component "Servicio de Moderación" as SModeracion
  component "Servicio de Valoración" as SValoracion
  component "Servicio de Autenticación" as SAuth
}

' ====================================
' BASE DE DATOS
' ====================================
package "Persistencia (MongoDB Atlas)" as DBLayer {

  component "Repositorio de Comentarios" as RepoComentarios
  component "Repositorio de Apuntes" as RepoApuntes
  component "Repositorio de Valoraciones" as RepoValoraciones
}

node "MongoDB Atlas" as Mongo


' ====================================
' RELACIONES
' ====================================

' ---- Web UI → Backend ----
WebUI -down-> APIGW : HTTP/JSON\n(metadatos + URL PDF)

' ---- Sesión → Backend ----
SessionUI -down-> APIGW : Autenticación\n(OIDC)

' ---- Archivos → Vercel Blob ----
UploadUI -right-> VercelBlob : Subida/descarga\narchivos PDF

' ---- Backend → Servicios internos ----
APIGW --> SContenido
APIGW --> SModeracion
APIGW --> SValoracion
APIGW --> SAuth

' ---- Servicios → Repositorios ----
SContenido --> RepoApuntes
SContenido --> RepoComentarios

SModeracion --> RepoApuntes
SModeracion --> RepoComentarios
SModeracion --> RepoValoraciones

SValoracion --> RepoValoraciones
SValoracion --> RepoApuntes

' ---- Repositorios → Mongo ----
RepoComentarios --> Mongo
RepoApuntes --> Mongo
RepoValoraciones --> Mongo

' ---- Autenticación → Entra ID ----
SAuth --> Entra : Validar identidad\n(SSO/OIDC)

@enduml
