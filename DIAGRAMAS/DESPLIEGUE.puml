@startuml

skinparam backgroundColor #FFFFFF
skinparam shadowing true
skinparam roundcorner 12
skinparam linetype ortho

skinparam nodesep 140
skinparam ranksep 140

skinparam node {
  BackgroundColor #F8FAFC
  BorderColor #1E293B
  FontColor #0F172A
  FontSize 12
}

skinparam artifact {
  BackgroundColor #EEF2F7
  BorderColor #1E293B
  FontColor #0F172A
  FontSize 11
}

skinparam database {
  BackgroundColor #E5E7EB
  BorderColor #1E293B
  FontColor #0F172A
}

skinparam ArrowColor #4B5563
skinparam ArrowThickness 1.2

left to right direction

' ===== NODOS PRINCIPALES =====
node "Usuario Estudiante/Admin" as Usuario {
  artifact "Navegador Web" as Browser
}

' Nuevo nodo: CDN/Proxy (Cloudflare)
node "Cloudflare (CDN / Reverse Proxy)" as CDN

node "Frontend\n(Next.js en Vercel)" as Frontend {
  artifact "Aplicación Next.js" as NextApp
}

node "Vercel Blob Storage\n(Archivos PDF)" as Blob

node "Microsoft Entra ID\n(SSO / OIDC)" as Entra

node "Backend API\n(Node.js / Express / Docker)" as Backend {
  artifact "Controladores" as Controllers
  artifact "Servicios REST" as ServREST
  artifact "Repositorios (DAO)" as DAO
}

database "MongoDB Atlas\nCluster" as Mongo

' ===== LAYOUT OCULTO PARA POSICIÓN =====
Usuario -[hidden]-> CDN
CDN -[hidden]-> Frontend
Frontend -[hidden]-> Blob
Blob -[hidden]-> Backend

Frontend -[hidden]down-> Entra
Entra -[hidden]-> Backend

Backend -[hidden]down-> Mongo

' ===== CONEXIONES REALES =====

' Usuario -> CDN
Usuario -up-> CDN : \nHTTPS \n(Solicitudes pasan por Cloudflare)

' CDN -> Frontend
CDN -up-> Frontend : HTTPS

' Frontend -> Blob
Frontend -down-> Blob : Subida/descarga\narchivos PDF

' Frontend -> Backend
Frontend -right-> Backend : HTTPS\n(API REST)

' Backend -> Entra
Backend -down-> Entra : Validación\nOIDC / Tokens

' Backend -> Mongo
Backend -up-> Mongo : Conexión TLS\nsegura

@enduml
